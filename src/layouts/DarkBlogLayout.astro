---
import BaseLayout from './BaseLayout.astro';
import Header from '@/components/layout/Header.astro';
import Chip from '@/components/ui/Chip.astro';
import { formatDate } from '@/utils/formatDate';
import { getReadingTime, formatReadingTime } from '@/utils/getReadingTime';
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'blog'>;
  content?: string;
}

const { post, content = '' } = Astro.props;
const { title, description, date, tags, author } = post.data;
const readingTime = getReadingTime(content);
---

<BaseLayout
  title={title}
  description={description}
  type='article'
  class='min-h-screen bg-slate-900'
>
  <!-- Fixed Header -->
  <Header />
  
  <!-- Main Content Area -->
  <main class='mt-16'>
    <div class='max-w-4xl mx-auto px-8 py-8'>
      <!-- Article Header with Meta Info -->
      <header class='mb-12'>
        <!-- Title -->
        <h1 class='text-4xl font-bold text-white mb-6'>{title}</h1>

        <!-- Meta Information -->
        <div class='flex items-center text-sm text-slate-400 mb-6 space-x-4'>
          <span>作者: {author}</span>
          <span>•</span>
          <time datetime={date.toISOString()}>
            {formatDate(date)}
          </time>
          <span>•</span>
          <span>{formatReadingTime(readingTime)}</span>
        </div>

        <!-- Tags -->
        {
          tags && tags.length > 0 && (
            <div class='flex flex-wrap gap-2 mb-6'>
              {tags.map(tag => (
                <Chip 
                  tag={tag}
                  href={`/blog/tag/${tag}`}
                  variant="secondary"
                />
              ))}
            </div>
          )
        }

        <!-- Description -->
        <p class='text-lg text-slate-300 leading-relaxed border-l-4 border-blue-500 pl-6 mb-8'>{description}</p>
        
        <!-- Back to blog link -->
        <a 
          href='/blog' 
          class='inline-block text-blue-400 hover:text-blue-300 transition-colors mb-8'
        >
          ← 返回所有文章
        </a>
      </header>

      <!-- Article Content -->
      <article class='prose prose-lg prose-invert max-w-none'>
        <slot />
      </article>
    </div>
  </main>
</BaseLayout>
